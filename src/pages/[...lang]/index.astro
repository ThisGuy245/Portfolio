---
import Nav from '../../components/Nav.astro';
import { languages } from '../../i18n/ui';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/Hero.svelte';
import ProjectCard from '../../components/ProjectCard.astro';

export async function getStaticPaths() {
    return languages.map(lang => ({
        params: { lang: lang.key },
        props: { lang: lang.key }
    }));
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Map technology names to icon paths
function getTechIcons(technologies: string[]): string[] {
    const iconMap: Record<string, string> = {
        'c++': '/devIcons/Cpp.svg',
        'cpp': '/devIcons/Cpp.svg',
        'c#': '/devIcons/CSharp.svg',
        'csharp': '/devIcons/CSharp.svg',
        'python': '/devIcons/Python.svg',
        'javascript': '/devIcons/JS.svg',
        'typescript': '/devIcons/TypeScript.svg',
        'unreal': '/devIcons/Unreal.svg',
        'unity': '/devIcons/Unity.svg',
        'opengl': '/devIcons/SDL.svg',
        'sdl2': '/devIcons/SDL.svg',
        'astro': '/devIcons/Astro.svg',
        'Astro.svg': '/devIcons/Astro.svg',
        'svelte': '/devIcons/Svelte.svg',
        'Svelte': '/devIcons/Svelte.svg',
        'html': '/devIcons/HTML.svg',
        'css': '/devIcons/CSS.svg',
        'ai': '/devIcons/Python.svg',
    };

    return technologies
        .map(tech => iconMap[tech.toLowerCase()] || null)
        .filter((icon): icon is string => icon !== null);
}

// Get featured projects
const featuredProjects = [
    {
        title: t('Game Studio Project'),
        body: t('gameStudioDescription'),
        href: `/${lang}/projects`,
        placeholderImg: '/media/GSP.png',
        category: t('Games Programming'),
        teamSize: 8,
        technologies: ['c++', 'unreal', 'unity'],
        icons: []
    },
    {
        title: t('AI Game Engine'),
        body: t('aiGameEngineDescription'),
        href: `/${lang}/projects`,
        placeholderImg: '/media/Test.png',
        category: t('Games Programming'),
        teamSize: 1,
        technologies: ['c++', 'ai'],
        icons: []
    },
    {
        title: t('Guesthouse Site'),
        body: t('BZHdesc'),
        href: `/${lang}/projects`,
        placeholderImg: '/media/Domaine.jpg',
        category: t('Web Programming'),
        websiteUrl: "https://le-domaine.fr/en-GB/",
        teamSize: 1,
        technologies: ['Astro.svg', 'Svelte', 'typescript'],
        icons: []
    }
].map(project => ({
    ...project,
    icons: getTechIcons(project.technologies)
}));
---

<Layout title={t('welcome')}>
    <Nav lang={lang} />

    <main class="main-content">
        <!-- Hero Section -->
        <Hero client:load />

        <!-- Skills Preview Section -->
        <section class="skills-preview">
            <h2 class="section-title">Focus Areas</h2>
            <div class="skills-grid">
                <div class="skill-item">
                    <h3>Game Development</h3>
                    <p>C++, C#, Unreal Engine, Unity</p>
                </div>
                <div class="skill-item">
                    <h3>AI & Machine Learning</h3>
                    <p>PyTorch, Keras, LLM Integration</p>
                </div>
                <div class="skill-item">
                    <h3>Web Development</h3>
                    <p>Astro, Svelte, TypeScript</p>
                </div>
            </div>
        </section>

        <!-- Featured Projects Section -->
        <section class="featured-projects">
            <h2 class="section-title">{t('featuredProjects')}</h2>
            <div class="projects-grid">
                {featuredProjects.map(project => (
                    <ProjectCard project={project} />
                ))}
            </div>
            <div class="projects-cta">
                <a href={`/${lang}/projects`} class="btn btn-secondary">View All Projects</a>
            </div>
        </section>
    </main>
</Layout>

<style>
    .main-content {
        padding: var(--space-xl) var(--space-md);
        max-width: 1200px;
        margin: 0 auto;
    }

    .section-title {
        font-size: clamp(1.75rem, 4vw, 2.5rem);
        font-weight: 600;
        margin: 0 0 var(--space-xl);
        text-align: center;
        letter-spacing: -0.02em;
    }

    /* Skills Preview */
    .skills-preview {
        margin: var(--space-2xl) 0;
        padding: var(--space-xl) 0;
    }

    .skills-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-md);
        max-width: 800px;
        margin: 0 auto;
    }

    .skill-item {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 12px;
        padding: var(--space-lg);
        text-align: center;
        transition: all 0.2s ease;
    }

    .skill-item:hover {
        border-color: var(--color-accent);
        transform: translateY(-2px);
    }

    .skill-item h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0 0 var(--space-xs);
        color: var(--color-text);
    }

    .skill-item p {
        font-size: 0.9375rem;
        color: var(--color-text-muted);
        margin: 0;
    }

    /* Featured Projects */
    .featured-projects {
        margin: var(--space-2xl) 0;
        padding: var(--space-xl) 0;
    }

    .projects-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-lg);
        margin-bottom: var(--space-xl);
    }

    .projects-cta {
        text-align: center;
        margin-top: var(--space-xl);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 500;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }

    .btn-secondary {
        background: transparent;
        color: var(--color-text);
        border-color: var(--color-border);
    }

    .btn-secondary:hover {
        background: var(--color-surface);
        border-color: var(--color-accent);
        color: var(--color-accent);
    }

    @media (min-width: 768px) {
        .skills-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .projects-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .projects-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
</style>
